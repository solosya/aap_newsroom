{{ use('yii/web/JqueryAsset') }}
{{ register_jquery_asset() }}
{% set networkData   = _Network.getNetworkData() %}
{% set blogData      = _Blog.getBlog() %}
{% set pageClass     = _Page.getBodyClass() %}
{% set pageTypeClass = blogData.type %}
{% set blogName      = blogData.title %}
{% set pageURL       = _AppHelper.getCurrentUrl(true) %}

{#     turn this on when the sdk goes through cognitives #}
{% set redir = _Page.setHttpRedirects(
    {
        '|^/subscriptions.*|': 'http://service.newsroom.co.nz',
        '|^/categories.*|'   : 'http://service.newsroom.co.nz',
        '|^/newswires.*|'    : 'http://service.newsroom.co.nz',
        '|^/catalog.*|'      : 'http://service.newsroom.co.nz',
        '|^/stories.*|'      : 'http://service.newsroom.co.nz',
        '|^/assets.*|'       : 'http://service.newsroom.co.nz',
        '|^/users.*|'        : 'http://service.newsroom.co.nz',
        '|^/feeds.*|'        : 'http://service.newsroom.co.nz',
    }, true) 
%} 



{% set showPaywall = false %}
{% set paywallSection = false %}
{% set isAdmin = _User.isAdminUser() %}

{% if blogData['additionalInfo'] is defined             and 
      blogData['additionalInfo']['paywall'] is defined  and 
      blogData['additionalInfo']['paywall'] == 'on' %}
    {% set paywallSection = true %}
{% endif %}
{# {{dump(blogData['additionalInfo'])}}

{{dump(paywallSection)}} #}
{# {% set url = _AppHelper.getParsedUrl().path %} #}

{# Pages don't have a blogName so class has to be used #}
{% if   not _User.isAdminUser()         and
        paywallSection == true          and
        blogData['showPaywall'] == true and
        'article' not in pageClass %}
    
        {% set showPaywall = true %}
        {% set layout = "layout-marketing" %}
    
{% endif %}


{# {% if _AppHelper.getApplicationEnv() != 'PROD'%}
    {% set showPaywall = false %}
{% endif %} #}









{{ this.beginPage() }}
<!DOCTYPE html>
<html lang="en-AU" prefix="og: http://ogp.me/ns#">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
    <meta http-equiv="Accept-CH" content="DPR, Viewport-Width, Width">
    <meta name="google-site-verification" content="K-ToGDFxKuQdd_Ykjo1EJDCtGoS7xmid2Pge0cqUxPw" />

    <link rel="profile" href="http://gmpg.org/xfn/11">
    <title>{{ this.title }}</title>
    {{ Html.csrfMetaTags | raw }}

    {% set favicon = '' %}
    {% if networkData.favMedia | length > 0 %}
        {% set favicon = _Media.getMediaUrl(networkData.favMedia, 80, 80)%}
    {% endif %}

    <link rel="shortcut icon" href="{{favicon}}" />
    <link rel="icon" href="{{favicon}}" sizes="any" type="image/svg+xml" />
    <link rel="apple-touch-icon" href="{{networkData.templatePath}}/static/images/apple-logo.png" sizes="any" type="image/svg+xml" />
    <link href='https://fonts.googleapis.com/css?family=Tinos:400,700' rel='stylesheet' type='text/css'>
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600,700" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=IM+Fell+Great+Primer:400i" rel="stylesheet"> 
    
    {% set primaryFont = networkData['styling']['fonts']['primaryFont'] %}
    {% set secFont = networkData['styling']['fonts']['secondaryFont'] %}

    {% if primaryFont != "" %}
        <link href='https://fonts.googleapis.com/css?family={{primaryFont}}' rel='stylesheet' type='text/css'>
    {% endif %}
    {% if secFont != "" %}
        <link href='https://fonts.googleapis.com/css?family={{secFont}}' rel='stylesheet' type='text/css'>
    {% endif %}
    
    <link rel="alternate" type="application/rss+xml" title="{{_Network.getNetworkTitle()}} -  RSS Feeds" href="http://{{networkData.defaultDomain['domain']}}/feed/rss"/>


    {% if _AppHelper.getApplicationEnv() == 'PROD'%}
        <link rel="stylesheet" href="{{networkData.templatePath}}/static/css/concat.min.css?v=69ae2104" type="text/css" media="all">
    {% else %}
        <link type="text/css" rel="stylesheet" href="{{networkData.templatePath}}/assets/scripts/plugins/jquery.fancybox/source/jquery.fancybox.css?ver=2" />
        <link type="text/css" rel="stylesheet" href="{{networkData.templatePath}}/assets/scripts/plugins/jquery.noty-2.3.8/demo/animate.css?ver=1" />
        <link type="text/css" rel="stylesheet" href="{{networkData.templatePath}}/assets/scripts/sdk/media-player/mediaelementplayer.css?ver=1" />
        <link rel='stylesheet' href='{{networkData.templatePath}}/static/css/concat.css?ver=16' type='text/css' media='all' />
    {% endif %}


    <script src="https://js.stripe.com/v3/"></script>

    {#<script src="https://use.typekit.net/unp4tin.js"></script>
    <script>try{Typekit.load({ async: true });}catch(e){}</script>#}


    
<!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->

    <!-- Google Tag Manager -->
    {% if networkData.thirdPartyIntegrations['googleTagManager'] | length > 0 %}
        {{networkData.thirdPartyIntegrations['googleTagManager']['script'] | raw}}
    {% endif %}


{% if _User.isGuest() %}
    <script>
        (function(d) {
        var el, fjs = d.getElementsByTagName('script')[0];
            el = d.createElement('script');
            el.id = "js-pp-banner";
            el.src = "//dashboard.presspatron.com/dev/banner?b=AbkE2e7ZwQgwLPFzVowC2cKm";
            fjs.parentNode.insertBefore(el, fjs);
        }(document));
    </script>
{% endif %}



    {% set googleAnalyitcsId = ''%}
    {% if networkData.thirdPartyIntegrations['googleAnalytics']['id'] is defined and  networkData.thirdPartyIntegrations['googleAnalytics']['id'] is not empty  %}
        {% set googleAnalyitcsId = networkData.thirdPartyIntegrations['googleAnalytics']['id'] %}
    {% endif %}

    {% if googleAnalyitcsId is defined and googleAnalyitcsId is not empty%}
        <!-- Google Analytics u -->
        <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', '{{googleAnalyitcsId}}', 'auto');
        ga('send', 'pageview');
        </script>
        <!-- End Google Analytics -->
    {% endif %}
    

    {{ this.head() }}
    





    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-9270963482105934",
        enable_page_level_ads: true
      });
    </script>
    <script async='async' src='https://www.googletagservices.com/tag/js/gpt.js'></script>
    <script>
      var googletag = googletag || {};
      googletag.cmd = googletag.cmd || [];
      // googletag.pubads().setTargeting('pagename', '{{ blogName | lower }}');

    </script>

    <script type="text/javascript">
    var axel = Math.random() + "";
    var a = axel * 10000000000000;
    document.write('<iframe src="https://8621311.fls.doubleclick.net/activityi;src=8621311;type=pansite;cat=pansi0;dc_lat=;dc_rdid=;tag_for_child_directed_treatment=;ord=' + a + '?" width="1" height="1" frameborder="0" style="display:none"></iframe>');
    </script>
     
  



    {# 'figure out the nav sub menu to send through to the header and footer' #}
    {% set submenu = [] %}
    {% set roomInfo = ['newsroom', networkData.defaultBlogUrl] %}

    {% set menuItems = _Menu.get({'menuType': 'header'}) %}

    {% set rooms = [] %}
    {% for room in menuItems  %}
        {% set rooms = rooms | merge([room.blogTitle | lower]) %}
        {% if (room.blogTitle == blogName) %}
            {% set submenu = room.children %}
            {% set roomInfo = [room.blogTitle, room.link] %}
        {% endif %} 
    {% endfor %}

    {# futurelearning to be treated like a room kinda #}
    {% set rooms = rooms | merge(['futurelearning']) %}


    {% if (submenu | length == 0 and blogName | lower not in rooms) %}
        {% for room in menuItems if submenu | length == 0 %}
            {% for childItem in room.children if submenu | length == 0 %}
                {% if (childItem.menu_blog_id == blogData.id) %}
                    {% set submenu = room.children %}
                    {% set roomInfo = [room.blogTitle, room.link] %}
                {% endif %} 
            {% endfor %}
        {% endfor %}
    {% endif %} 

 {% if (blogName | lower == 'futurelearning') %}
        {% set roomInfo = ['futurelearning', "/@future-learning"] %}
 {% endif %}



    {# 'Newsroom is the default header logo but want to suppress it in
     top 'room' nav when a sub channel is active' #}
    {% set header_exclude = '' %}
    {% if (blogName | lower not in rooms) %}
        {% set header_exclude = 'newsroom' %}
    {% endif %} 







    {{ this.render('partials/ads.twig', {
        networkData: networkData,
        blogData: blogData
    }) | raw }}


</head>



<body class="{{ pageTypeClass }} {{ blogName | replace({" ": "_"}) | lower }} {{ pageClass }}" data-isAdmin="{{ isAdmin }}" data-paywall="{{blogData['showPaywall']}}">
{{ this.beginBody() }}

    {% if  blogName  | lower != "newsroom pro" %}  
        <div class="add add-header__topbanner">
            {# <span class="add-text" style="display:block;margin:0 auto;">Advertisement</span> #}
            <div id="newAdBanner"></div> 
        </div><!--add add-header-top-->
    {% else %}
         <div class="add add-header__topbanner"></div>
    {% endif %}

    {{ this.render('partials/_header_navigation.twig', {
        networkData : networkData, 
        headerMenu  : menuItems, 
        pageClass   : blogName,
        roomInfo    : roomInfo,
        submenu     : submenu,
        pageURL     : pageURL,
        rooms       : rooms,
        paywallSection : paywallSection,
    }) | raw }}

    {# <div class="col-sm-8 hidden-sm hidden-md hidden-lg">
        <div class="add add-header-mob hidden-sm hidden-md hidden-lg">
            <div id='tinybannerAd' style='height:75px; width:300px;'>
                <script>
                    document.currentScript.parentNode.id = tinybannerID;
                    googletag.cmd.push(function() { googletag.display(tinybannerID); });
                </script>
            </div>
 
        </div>
    </div> #}


    {% if showPaywall %}
        {{ this.render('/layout-marketing.twig', {networkData: networkData}) | raw }}
    {% else %}
        {{ content | raw }}
    {% endif %}




    {{ this.render('partials/footer.twig', {
        networkData : networkData, 
        headerMenu  : menuItems, 
        pageClass   : blogName,
        roomInfo    : roomInfo,
        submenu     : submenu,
        rooms       : rooms,
        paywallSection : paywallSection
    }) | raw }}


    {{ this.render('partials/_javascript.twig', {
        networkData: networkData
    }) | raw }}


    <div class="SwappingHelper" style="display:none">
        <div style="width: 270px; height: 105px; padding: 3px; background-color: #FFF; max-width: 270px; max-height: 105px; overflow: hidden; z-index: 999 !important;">
            <img class="article-image" src="{{networkData.placeHolder100x100}}" style="width:97px; height: 97px; float: left;" />
            <p class="article-text" style="width: 165px; float: left; padding-left: 3px;color: #394659;font-size: 14px; font-family: Droid Serif,serif; line-height: 20px; margin-top:0px;">Dummy text  </p>
        </div>
    </div>


    <!-- START Nielsen Online SiteCensus V6.0 -->
    <!-- COPYRIGHT 2012 Nielsen Online -->
    <script type="text/javascript" src="//secure-nz.imrworldwide.com/v60.js"></script>
    <script type="text/javascript">
        var pvar = { cid: "nz-newsroom", content: "0", server: "secure-nz" };
        var trac = nol_t(pvar);
        trac.record().post();
    </script>
    <noscript>
     <div>
        <img src="//secure-nz.imrworldwide.com/cgi-bin/m?ci=nz-newsroom&amp;cg=0&amp;cc=1&amp;ts=noscript" width="1" height="1" alt="" />
     </div>
    </noscript>
    <!-- END Nielsen Online SiteCensus V6.0 -->
    <!-- END Nielsen Online SiteCensus V6.0 -->



    {# {{this.registerJs("
        Acme.videoPopupView = new Acme.videoPopup('modal', 'signin', 
                {'video' : 'modalVideo'}, 
                {path: _appJsConfig.templatePath});")}} #}
    
    
    {% if _User.isGuest() %}
        {{this.registerJs("var popup = new Acme.registerPopUp('register_popup');")}}
    {% endif %}

    {{ this.endBody() }}


</body>

{{ this.endPage() }}

</html>